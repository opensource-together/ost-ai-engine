# GitHub Scraper Service Makefile

.PHONY: help build test clean lint format deps run

# Default target
help:
	@echo "Available targets:"
	@echo "  build   - Build the application"
	@echo "  test    - Run tests"
	@echo "  clean   - Clean build artifacts"
	@echo "  lint    - Run linters"
	@echo "  format  - Format code"
	@echo "  deps    - Download dependencies"
	@echo "  run     - Run the application"

# Build the application
build:
	@echo "ğŸ”¨ Building GitHub scraper..."
	go build -ldflags="-s -w" -o main .
	@echo "âœ… Build completed"

# Run tests
test:
	@echo "ğŸ§ª Running tests..."
	go test -v ./...
	@echo "âœ… Tests completed"

# Clean build artifacts
clean:
	@echo "ğŸ§¹ Cleaning build artifacts..."
	rm -f main
	go clean -cache
	@echo "âœ… Clean completed"

# Run linters
lint:
	@echo "ğŸ” Running linters..."
	golangci-lint run
	@echo "âœ… Linting completed"

# Format code
format:
	@echo "ğŸ¨ Formatting code..."
	go fmt ./...
	goimports -w .
	@echo "âœ… Formatting completed"

# Download dependencies
deps:
	@echo "ğŸ“¦ Downloading dependencies..."
	go mod tidy
	go mod download
	@echo "âœ… Dependencies updated"

# Run the application with default settings
run: build
	@echo "ğŸš€ Running GitHub scraper..."
	./main --query "language:go stars:>100" --max-repos 5

# Run with custom settings
run-custom: build
	@echo "ğŸš€ Running with custom settings..."
	./main --query "language:python stars:>500" --max-repos 10

# Install development tools
install-tools:
	@echo "ğŸ› ï¸ Installing development tools..."
	go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest
	go install golang.org/x/tools/cmd/goimports@latest
	@echo "âœ… Tools installed"

# Performance benchmark
bench:
	@echo "âš¡ Running performance benchmarks..."
	go test -bench=. -benchmem ./...
	@echo "âœ… Benchmarks completed"

# Security scan
security:
	@echo "ğŸ”’ Running security scan..."
	gosec ./...
	@echo "âœ… Security scan completed"
